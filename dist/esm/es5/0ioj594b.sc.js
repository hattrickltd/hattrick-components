/*! Built with http://stenciljs.com */
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function r(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),__generator=this&&this.__generator||function(t,e){var a,r,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,r&&(n=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[0,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};import{h}from"./ht-components.core.js";import{a as LazyLoadedComponent}from"./chunk-b197b654.js";var __awaiter=function(t,e,a,r){return new(a||(a=Promise))(function(n,o){function i(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):new a(function(e){e(t.value)}).then(i,s)}c((r=r.apply(t,e||[])).next())})},originalSize={width:92,height:123},facecardSize={width:110,height:155},Avatar=function(t){function e(){var e=t.apply(this,arguments)||this;return e.avatarSize=facecardSize,e.silhouettePath="silhouettes/sil[nr].png",e.facecardPath="backgrounds/card1.png",e.avatarPath="/Img/Avatar/",e.base="",e.background=!0,e.facecard=!0,e.injury=!0,e.round=!1,e.square=!1,e.lazy=!0,e.images=[],e.pendingImages=[],e}return __extends(e,t),e.prototype.componentDidLoad=function(){this.updateAvatar()},e.prototype.updateAvatar=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(a){switch(a.label){case 0:return this.images=[],this.pendingImages.forEach(function(t){return t.src=""}),this.pendingImages=[],e={background:this.background,injury:this.injury,facecard:this.facecard},this.avatarSize=Object.assign({},e.facecard?facecardSize:originalSize),(this.round||this.square)&&(this.avatarSize.height=this.avatarSize.width),[4,this.lazy];case 1:return a.sent()?("lazyLoad",t.prototype.lazyLoad).call(this,this.host):Promise.resolve(),this.loadAvatar(this.parts,e),[2]}})})},e.prototype.loadAvatar=function(t,e){var a=this;e=Object.assign({background:!1,injury:!1,facecard:!1},e);var r=[];if("string"!=typeof t||t.startsWith("data:")||(t=JSON.parse(t)),t instanceof Array&&t.length>0){var n=0;e.facecard&&(n++,r.push(this.loadFacecard().then(function(t){return a.addImage(t,0),t}))),t.forEach(function(t){if(a.shouldIncludePart(t,e)){var o=n++;r.push(a.loadAvatarPart(t,e).then(function(t){return a.addImage(t,o),t}))}})}else"string"==typeof t&&t.startsWith("data:")?r.push(this.loadDataUrl(this.parts).then(function(t){return a.images=[t],t})):r.push(this.loadSilhouette(t,e).then(function(t){return a.addImage(t),t}));return Promise.all(r).then(function(){a.load.emit(a.images)})},e.prototype.addImage=function(t,e){void 0===e&&(e=0);var a=this.images.slice();a[e]=t,this.images=a},e.prototype.shouldIncludePart=function(t,e){return!(!t||!t.url||!e.background&&t.url.indexOf("background")>-1||!e.injury&&t.url.indexOf("injur")>-1)},e.prototype.loadAvatarPart=function(t,e){var a=this;return new Promise(function(r,n){var o=a.createImage();a.pendingImages.push(o);var i=t.url;i.indexOf("silhouettes/")>-1&&(i=i.substring(i.indexOf("silhouettes/"))),i=i.indexOf("//")>-1?i.replace("//","https://"):a.base+a.avatarPath+i,o.onload=function(){a.pendingImages.splice(a.pendingImages.indexOf(o),1),r({img:o,x:t.x-(e.facecard?0:9),y:t.y-(e.facecard?0:10)})},o.onerror=function(){return n()},o.src=i})},e.prototype.loadFacecard=function(){var t=this;return new Promise(function(e,a){var r=t.createImage();t.pendingImages.push(r),r.onload=function(){t.pendingImages.splice(t.pendingImages.indexOf(r),1),e({img:r,x:0,y:0})},r.onerror=function(){return a()},r.src=t.base+t.avatarPath+t.facecardPath})},e.prototype.loadSilhouette=function(t,e){var a=this;return new Promise(function(r,n){var o=a.createImage();a.pendingImages.push(o),o.onload=function(){a.pendingImages.splice(a.pendingImages.indexOf(o),1),r({img:o,x:e.facecard?0:-9,y:e.facecard?0:-9})},o.onerror=function(){return n()},o.src=a._getSilhouetteUrl(t)})},e.prototype.loadDataUrl=function(t){var e=this;return new Promise(function(a){var r=e.createImage();r.onload=function(){a({img:r,x:0,y:0})},r.src=t})},e.prototype._getSilhouetteUrl=function(t){var e=t?t%12+1:Math.floor(11*Math.random())+1;return this.base+this.avatarPath+this.silhouettePath.replace("[nr]",e.toString())},e.prototype.createImage=function(){var t=new Image;return t.setAttribute("async","true"),t.setAttribute("crossOrigin","anonymous"),t},e.prototype.printToCanvas=function(t){var e=document.createElement("canvas"),a=e.getContext("2d");return e.width=this.avatarSize.width,e.height=this.avatarSize.height,(t||this.images).forEach(function(t){a.drawImage(t.img,t.x,t.y)}),e},e.prototype.hostData=function(){return{role:"img",class:{"ht-avatar-round":this.round,"ht-avatar-square":this.square,"ht-avatar-has-facecard":this.facecard}}},e.prototype.render=function(){var t=this;return h("div",null,this.images.map(function(e){return h("img",{src:e.img.src,style:{width:e.img.naturalWidth/t.avatarSize.width*100+"%",height:e.img.naturalHeight/t.avatarSize.height*100+"%",left:e.x/t.avatarSize.width*100+"%",top:e.y/t.avatarSize.height*100+"%"}})}))},Object.defineProperty(e,"is",{get:function(){return"ht-avatar"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{background:{type:Boolean,attr:"background"},base:{type:String,attr:"base"},facecard:{type:Boolean,attr:"facecard"},host:{elementRef:!0},images:{state:!0},injury:{type:Boolean,attr:"injury",watchCallbacks:["updateAvatar"]},lazy:{type:Boolean,attr:"lazy"},parts:{type:"Any",attr:"parts",watchCallbacks:["updateAvatar"]},printToCanvas:{method:!0},round:{type:Boolean,attr:"round"},square:{type:Boolean,attr:"square"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"load",method:"load",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"[data-ht-avatar-host]{position:relative;display:inline-block;width:calc(92px * var(--avatar-size,1));height:calc(123px * var(--avatar-size,1))}.ht-avatar-has-facecard[data-ht-avatar-host]{width:calc(110px * var(--avatar-size,1));height:calc(155px * var(--avatar-size,1))}.ht-avatar-round[data-ht-avatar-host], .ht-avatar-square[data-ht-avatar-host]{height:calc(92px * var(--avatar-size,1))}.ht-avatar-has-facecard.ht-avatar-round[data-ht-avatar-host], .ht-avatar-has-facecard.ht-avatar-square[data-ht-avatar-host]{height:calc(110px * var(--avatar-size,1))}div[data-ht-avatar]{position:relative;overflow:hidden;width:100%;height:100%}.ht-avatar-round[data-ht-avatar-host]   div[data-ht-avatar]{border-radius:100%}img[data-ht-avatar]{position:absolute}"},enumerable:!0,configurable:!0}),e}(LazyLoadedComponent);export{Avatar as HtAvatar};